<!DOCTYPE html><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="topic-type" content="topic">

<meta name="product" content="MAYAUL">
<meta name="release" content="2025">
<meta name="book" content="GeneralUser">
<meta name="component" content="Maya-Scripting">
<meta name="created" content="30/7/2024">
<meta name="generatedby" content="TRIDION">
<meta name="user-comments" content="disable">
<meta name="topicid" content="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8">
<meta name="language" content="CHS">
<title>定义程序</title>

	<link rel="stylesheet" type="text/css" href="../style/client.css">
	<script type="text/javascript" src="../scripts/client.js"><!--filler--></script>
</head>
<body id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8">
<div class="head"><div class="head-block"><div class="button-info"><span id="infoline"> </span></div>
<div class="ancestry"> </div>
<div class="head-text"><h1>定义程序</h1></div>
</div>
</div>

<div class="body"><div class="section" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F48755-3D114B7511841AEFA9F-10AB"><h2 class="title sectiontitle">全局程序</h2>

<p class="p" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F48755-3D114B7511841AEFA9F-10AA"> 一旦定义了全局程序，您可以在任意位置调用它：从任意脚本文件、在任意函数中、或从命令行。全局程序声明的常规形式如下所示：</p>

<pre class="pre codeblock">
global proc <pre class="pre codeblock">
<em class="ph i" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-86F280C5-01F3-49FC-9389-B87E565227E9">return_type</em></pre>
 <pre class="pre codeblock">
<em class="ph i" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-B474F253-2797-4CD0-8064-26B08257FA00">procedure_name</em></pre>
 ( <pre class="pre codeblock">
<em class="ph i" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-9BDD7E32-3C3C-45A6-83E0-C5E579CF0431">arguments</em></pre>
 ) { 
	<pre class="pre codeblock">
<em class="ph i" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-809689A7-4F66-4456-9066-71914D9C613E">MEL_statements </em></pre>

}
</pre>

<ul class="ul" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F48755-3D114B7511841AEFA9F-10A8"><li class="li" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F48755-3D114B7511841AEFA9F-10A7"><samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-27EE9F55-0962-4987-B5BB-0B24BF88CBAF">global</samp> 关键字使新程序在任意位置可用。</li>
<li class="li" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F48755-3D114B7511841AEFA9F-10A6"><samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-E50D5B77-8F4C-45B8-A5ED-24F3496D5FDF">proc</samp> 关键字指示您正在定义程序。</li>
<li class="li" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F48755-3D114B7511841AEFA9F-10A5">可以在 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-5040C955-51A3-4BAD-8703-7663C9E78472">proc</samp> 后为程序的返回类型添加关键字。例如，如果程序返回一个整数，请键入 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-D1E69992-3D9F-4CB0-9173-E38DE03F969F">int</samp>。如果程序不返回值，可以忽略。</li>
<li class="li" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F48755-3D114B7511841AEFA9F-10A4">程序的名称。</li>
<li class="li" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F48755-3D114B7511841AEFA9F-10A3">参数列表，包括在括号内，且之间用逗号分隔。每个参数都是一个前面带有其类型（例如 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-8B787362-D802-43A3-A935-9AB94149E0F0">string</samp>）的变量名（以 $ 开头）。</li>
<li class="li" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F48755-3D114B7511841AEFA9F-10A2">要在调用程序时执行的代码块。</li>
</ul>

</div>
<div class="section" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F48755-3D114B7511841AEFA9F-10A1"><h2 class="title sectiontitle">返回值</h2>

<p class="p" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F48755-3D114B7511841AEFA9F-10A0">如果为程序指定了返回类型，则必须在程序代码块中的某位置使用 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-279E3FCF-6EBE-4A64-AAE2-A49DF53F7318">return</samp> 运算符才会返回值。</p>

<pre class="pre codeblock">
global proc float square(float $x) {
	return $x * $x;
}
square(5.0);
25
</pre>

<p class="p" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F48755-3D114B7511841AEFA9F-109F"> 如果没有为程序指定返回类型（指示该程序将不会返回值），则您只能指定 return 运算符，而不返回值。在该上下文中使用的 return 运算符相当于函数中断符。 </p>

<pre class="pre codeblock">
// This does not work. 
global proc add5(int $x) {return $x+5;}; 
// Error: global proc cc(int $x) {return $x+5;}; // 
// Error: This procedure has no return value. //
// This works. 
global proc add5(int $x) {return;};" 
</pre>

</div>
<div class="section" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F48755-3D114B7511841AEFA9F-109D"><h2 class="title sectiontitle">示例</h2>

<p class="p" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F48755-3D114B7511841AEFA9F-109C">以下是一些程序声明示例：</p>

<pre class="pre codeblock">
global proc string sayHi() {
	return "Hello!\n";
}
global proc float square(float $x) {
	return $x * $x;
}
global proc int max(int $a, int $b) {
	if ($a &gt; $b) {
		return $a;
	} else 
		return $b;
}
global proc msg() {
	print "This proc has no return value.\n";
}
</pre>

</div>
<div class="section" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F48755-3D114B7511841AEFA9F-109B"><h2 class="title sectiontitle">局部程序</h2>

<p class="p" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F48755-3D114B7511841AEFA9F-109A">如果在程序声明的开头不使用 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-59ED4668-483B-4375-8427-858CA4D7D7E2">global</samp> 关键字，则该程序对于在其中定义它的文件是局部的。</p>

<pre class="pre codeblock">
// This is a local procedure
// that is only visible to the code in this file.
proc red5() {print("red5 standing by...\n");}
</pre>

<p class="p" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F48755-3D114B7511841AEFA9F-1099"> 这对于生成对其他程序起作用的“辅助对象”程序非常有用。您可以对其他使用您的脚本的人员仅显示一个或两个全局程序，而隐藏辅助对象代码。</p>

<p class="p" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F48755-3D114B7511841AEFA9F-1097">不能在<span class="ph uicontrol" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-1143426C-BA0D-48D4-9BF8-92837D7DDF93">“脚本编辑器”(Script Editor)</span>中定义局部程序。它们仅在外部脚本文件中可用。</p>

<div class="note note" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F48755-3D114B7511841AEFA9F-1096"><span class="notetitle">注：</span> MEL 不允许您提前引用局部范围的程序。局部范围内的程序定义必须在被调用之前显示。例如，在名为 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-2F66F472-AA33-4F0F-94BD-3422287777DE">noForwardRef.mel</samp> 的文件中，引用局部程序之前定义这些程序。<p class="p" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F48755-3D114B7511841AEFA9F-1095"><samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-83C81A86-D265-4D6A-B5CA-F235A3B52B65">proc myLocalProc() { print </samp>"<samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-89B213AD-B55B-4DC3-A0BD-B680F18F97CF">In myLocalProc()\n</samp>"<samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-4648B48F-FFF7-48E9-9970-C274DD2EAFFF"> ; } proc anotherLocalProc() { print </samp>"<samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-6F7DCB8B-56CB-4E7B-9A7F-7117F6920DBB">In anotherLocalProc()\n</samp>"<samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-336E0FC4-B837-4A8F-B919-AA8249FC3BE7"> ; myLocalProc; } global proc noForwardRef() { print </samp>"<samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-670C4073-9F41-4CF7-92DE-D9CF43330AD5">Calling anotherLocalProc()\n</samp>"<samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-2C36667D-DF23-4965-A735-35295D56FD37"> ; anotherLocalProc; }</samp></p>
</div>

</div>
<div class="section" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F487553BD5B66812435C29801-2BF4"><h2 class="title sectiontitle">程序不能是未定义的</h2>

<p class="p" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F487553BD5B66812435C29801-2BF2">一旦定义了 MEL 程序，该程序将始终存在且无法删除。无论该程序是显式还是隐式创建都如此。通过使用 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-7E558CCF-9BD3-4E96-88C0-59D6D24D39A9">proc</samp> 指令（例如，<samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-55C7FD5E-5D18-454C-BFD4-C5D09E1D945E">proc foo(){}</samp>)显式创建程序 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-64738372-9797-4A24-920F-28B40F207F71">foo</samp>。可通过执行下列任一操作隐式创建尚未显式创建的程序 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-20B256B7-5D44-4892-B5E9-3B4D6932C1FF">foo</samp>：</p>

<ul class="ul" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F487553BD5B66812435C29801-2BF1"><li class="li" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F487553BD5B66812435C29801-2BF0">尝试以交互方式将其用作程序，例如，在<span class="ph uicontrol" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-A1A3CFD4-A1A9-48C8-B661-9CF232E10402">“脚本编辑器”(Script Editor)</span>中：<pre class="pre codeblock">
foo;
// Error: line 1: Cannot find procedure "foo". //
</pre>
</li>
<li class="li" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F487553BD5B66812435C29801-2BEF">将其用作其他程序的定义内的程序：<pre class="pre codeblock">
proc bar()
  {
     foo;
  }
</pre>
</li>
</ul>

<div class="section" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS1A9193826455F5FF-3D980B8612487088DED-6883"><h3 class="title sectiontitle">MEL 程序与插件命令</h3>

<p class="p" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS1A9193826455F5FF-3D980B8612487088DED-6882">通常，所有来自插件的程序和命令都应具有唯一名称。如果使用相同名称，比如说 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-D9F5C6AB-7224-4F02-9EB4-9CF99CA5EA1C">foo</samp>，对于程序和插件命令，将优先考虑程序。例如，如果同时具有： </p>

<ul class="ul" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS1A9193826455F5FF-3D980B8612487088DED-6881"><li class="li" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS1A9193826455F5FF-3D980B8612487088DED-6880">名为 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-BE856ADB-F0BC-4076-B6C3-B1803AF74892">foo</samp> 的隐式（或显式）定义的程序</li>
<li class="li" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS1A9193826455F5FF-3D980B8612487088DED-687F">带有名为 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-8AFBE798-802A-4402-9B15-627ECE4E6D9F">foo</samp> 的命令的已加载插件 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-BEE7B3F8-786F-493C-B603-E2CF1747B8B1">fooCmd</samp></li>
</ul>

<p class="p" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS1A9193826455F5FF-3D980B8612487088DED-687E">然后执行 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-7A6D8208-DAB9-4D6C-A9B1-A9FBFFC80D11">whatIs</samp> 命令，它将仅报告程序。</p>

<p class="p" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS1A9193826455F5FF-3D980B8612487088DED-687D">如果仅有隐式定义的 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-941BB5D8-8A17-4356-89E7-60828340705E">foo</samp>，仍可加载 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-E5B2112E-1515-43EA-90E5-497EE7CACEBE">fooCmd</samp> 插件并使用其 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-A160B115-08F8-42E9-A902-58E58E6B434B">foo</samp> 命令，即使 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-E77110A0-1304-4159-9944-2F6BF09CED4B">whatIs foo</samp> 将仅报告程序。但是，如果具有显式定义的 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-7593B621-0E08-4206-8A03-90ADDC5DA3CA">foo</samp> 作为 MEL 程序（例如，<samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-43D05DEA-4449-4D68-8658-A8CA2CF510BF">proc foo(){}</samp>)，则根本不能使用插件的 foo 命令。 </p>

</div>

<div class="section" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F487553BD5B66812435C29801-2BEB"><h3 class="title sectiontitle">解决方案</h3>

<p class="p" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F487553BD5B66812435C29801-2BEA">通过禁止 MEL 分析器将 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-81AD69FF-CC88-41D4-A394-B7FE7A33C4FB">foo</samp> 视为程序，可以解决隐式定义在其他程序定义中嵌入的程序 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-6245A2C8-4647-4C57-AD05-DAA6031B260A">foo</samp> 的问题。通过将 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-D090E738-2731-40C9-8B6C-F3A4BAD0B7CD">foo</samp> 的用法嵌入到字符串，然后使用该字符串调用 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-A03AFC0A-CBF5-4A73-8755-63E85CF45BBB">eval</samp>，可以执行该操作，如下所示。 </p>

<pre class="pre codeblock">
proc bar()
{
   if( `exists foo`){
    string $cmd = "foo -h";
    eval($cmd);
    }
}
</pre>

<div class="note note" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__WS73099CC142F487553BD5B66812435C29801-2BE9"><span class="notetitle">注：</span> 
<p class="p" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-D3C1FDE4-926E-434F-8657-22965A4DD7E9">如果 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-C30BA9B9-9C60-4C82-988D-1CD99199D0CC">foo</samp> 是名为 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-D032F98E-348E-44F1-9124-045D9E8ED509">fooCmd</samp> 的插件中定义的命令，应先检查 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-DF80621F-2D87-48DE-B68D-B6F5B257E023">foo</samp> 是否存在，以防在插件未加载时调用 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-EC1C0490-E2B3-4BC4-981C-C0FBBFE58348">bar()</samp>。在这种情况下，即使 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-7F2C6ACB-FAA0-4BC7-A133-249B59BA6FD8"> foo -h</samp> 已作为传递到 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-5051412F-B127-4DB2-909D-A5E89F5F8C3E">eval</samp> 语句的字符串，尝试执行 foo -h 仍将生成错误消息，但仍会隐式定义名为 <samp class="ph codeph" id="GUID-57849F80-358C-4A3E-A578-02D8DF9972D8__GUID-01380681-2EE1-494B-9E59-7691A7527E18">foo</samp> 的用户程序。</p>

</div>

</div>

</div>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a class="link" href="https://help.autodesk.com/cloudhelp/2025/CHS/Maya-Scripting/files/GUID-55D02EF2-8B2E-4ED0-AD9B-20FB3FAE581B.htm">过程</a></div>
</div>
</div>

</body>
</html>